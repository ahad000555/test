<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
  </head>
  <body>
    <section class="hero is-primary is-bold">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Meal Calculation System</h1>
        </div>
      </div>
    </section>

    <!-- Input Form -->
    <form id="form" class="container m-4 pl-4" method="POST">
      <div class="field">
        <label class="label">Day</label>
        <div class="control">
          <select id="day-select" class="input" name="Day">
            <option value="" disabled selected>Select a day</option>
            <!-- Dynamically populate days 1-31 -->
            <script>
              for (let i = 1; i <= 31; i++) {
                document.write('<option value="' + i + '">' + i + '</option>');
              }
            </script>
          </select>
        </div>
      </div>

      <div class="field">
        <label class="label">AHAD</label>
        <div class="control">
          <input class="input" type="text" placeholder="Enter AHAD" name="AHAD" />
        </div>
      </div>

      <div class="field">
        <label class="label">ABDULLAH</label>
        <div class="control">
          <input class="input" type="text" placeholder="Enter ABDULLAH" name="ABDULLAH" />
        </div>
      </div>

      <div class="field">
        <label class="label">MAHER</label>
        <div class="control">
          <input class="input" type="text" placeholder="Enter MAHER" name="MAHER" />
        </div>
      </div>

      <div class="field">
        <label class="label">HASAN</label>
        <div class="control">
          <input class="input" type="text" placeholder="Enter HASAN" name="HASAN" />
        </div>
      </div>

      <div class="field">
        <label class="label">BAZAR</label>
        <div class="control">
          <input class="input" type="text" placeholder="Enter BAZAR" name="BAZAR" />
        </div>
      </div>

      <div class="field is-grouped">
        <div class="control">
          <button class="button is-primary" type="submit" id="submit-button">
            Submit
          </button>
        </div>
        <div class="control">
          <button class="button is-danger" type="reset">
            Cancel
          </button>
        </div>
      </div>
    </form>

    <!-- Display Table -->
    <div class="container m-4">
      <table class="table is-bordered is-striped is-narrow is-hoverable">
        <thead>
          <tr>
            <th>Day</th>
            <th>AHAD</th>
            <th>ABDULLAH</th>
            <th>MAHER</th>
            <th>HASAN</th>
            <th>BAZAR</th>
          </tr>
        </thead>
        <tbody id="meal-table">
          <!-- Meal data will be inserted here -->
        </tbody>
      </table>
    </div>

    <script>
      // Fetch and display data on page load
      window.onload = function () {
        fetchMealData();
      };

      function fetchMealData() {
        fetch('https://script.google.com/macros/s/AKfycbwKvPfVHmjPnQrLk1IgWDVNJ77UMUxt98aZNhD1O4VAqu3e8GlYXdXVUKzFGCHbvajD/exec') // Replace with your script URL
          .then((response) => response.json())
          .then((data) => {
            const tableBody = document.getElementById('meal-table');
            tableBody.innerHTML = '';

            data.forEach((row) => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${row.Day}</td>
                <td>${row.AHAD}</td>
                <td>${row.ABDULLAH}</td>
                <td>${row.MAHER}</td>
                <td>${row.HASAN}</td>
                <td>${row.BAZAR}</td>
              `;
              tableBody.appendChild(tr);
            });
          })
          .catch((error) => {
            console.error('Error fetching data:', error);
          });
      }

      // Handle form submission
      document.getElementById('form').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = {};
        formData.forEach((value, key) => {
          data[key] = value;
        });

        fetch('https://script.google.com/macros/s/AKfycbwKvPfVHmjPnQrLk1IgWDVNJ77UMUxt98aZNhD1O4VAqu3e8GlYXdXVUKzFGCHbvajD/exec', {
          method: 'POST',
          body: new URLSearchParams(data),
        })
          .then((response) => response.json())
          .then(() => {
            alert('Data submitted successfully!');
            fetchMealData(); // Refresh the table with updated data
          })
          .catch((error) => {
            console.error('Error submitting data:', error);
            alert('Failed to submit data!');
          });
      });
    </script>
  </body>
</html>
